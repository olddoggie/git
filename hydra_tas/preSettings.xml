<?xml version="1.0" encoding="UTF-8"?>

<project name="project" default="run" basedir="." >
    <target name="checkOS">
        <condition property="os.linux">
            <os family="unix" />
        </condition>
        <condition property="os.windows">
            <os family="windows" />
        </condition>
    </target>

    <target name="getLinuxBit" depends="checkOS" if="os.linux">
        <exec executable="/bin/bash" outputproperty="linux-bit">
            <arg value="-c" />
            <arg value="getconf LONG_BIT" />
        </exec>
    </target>

    <target name="checkOSBit" depends="getLinuxBit">
        <property environment="env" />
        <condition property="linux.32">
            <and>
                <equals arg1="os.linux" arg2="true" />   
                <equals arg1="${linux-bit}" arg2="32" />
            </and>
        </condition>
        <condition property="linux.64">
            <and>
                <equals arg1="os.linux" arg2="true" />
                <equals arg1="${linux-bit}" arg2="64" />
            </and>
        </condition>
        <condition property="win.32">
            <and>
                <equals arg1="os.windows" arg2="true" />
                <not>
                    <contains string="${env.ProgramFiles(x86)}" substring="Program Files (x86)" />
                </not>
            </and>
        </condition>
        <condition property="win.64">
            <and>
                <equals arg1="os.windows" arg2="true" />
                <contains string="${env.ProgramFiles(x86)}" substring="Program Files (x86)" />
            </and>
        </condition>
    </target>

    <target name="checkMVNSettings" >
        <condition property="mvn_duplicated">
            <or>
                <and>
                    <available file="${user.home}/.m2/settings.xml.old" /> 
                    <not>  
                        <available file="${user.home}/.m2/settings.xml" />   
                    </not>
                </and>                
                <not>    
                    <and>
                        <available file="${user.home}/.m2/settings.xml" />   
                        <available file="${user.home}/.m2/settings.xml.old" />   
                    </and>
                </not>    
            </or>    
        </condition>
        <condition property="mvn_settings_only">
            <and>
                <available file="${user.home}/.m2/settings.xml" /> 
                <not>  
                    <available file="${user.home}/.m2/settings.xml.old" />   
                </not>
            </and>
        </condition>
    </target>

    <target name="init_mvn_settings" depends="checkMVNSettings" if="mvn_duplicated" >
        <copy file="settings.xml" toDir="${user.home}/.m2" overwrite="true" />
    </target>

    <target name="update_mvn_settings" depends="checkMVNSettings" if="mvn_settings_only" >
        <copy file="${user.home}/.m2/settings.xml" tofile="${user.home}/.m2/settings.xml.old" overwrite="true" />      
        <copy file="settings.xml" toDir="${user.home}/.m2" overwrite="true" />  
    </target>

    <target name="copy_mvn_settings" depends="init_mvn_settings,update_mvn_settings" />

    <target name="checkieDriver" >
        <available file="webDriverServer/IEDriverServer-32bit.exe" property="ieDriver_NotSet"/>
    </target>

    <target name="set_ie_driver64" if="win.64">
        <delete file="webDriverServer/IEDriverServer-32bit.exe" />
    </target>   

    <target name="set_ie_driver32" unless="win.64">
        <move file="webDriverServer/IEDriverServer-32bit.exe" tofile="webDriverServer/IEDriverServer.exe" overwrite="true" />
    </target>

    <target name="set_ie_driver_32or64" depends="set_ie_driver64,set_ie_driver32" />

    <target name="set_ie_driver" depends="checkieDriver" if="ieDriver_NotSet" >
        <antcall target="set_ie_driver_32or64" />
    </target>

    <target name="antrun" depends="checkOSBit,set_ie_driver" />
    <target name="run" depends="checkOSBit,copy_mvn_settings,set_ie_driver" />
</project>